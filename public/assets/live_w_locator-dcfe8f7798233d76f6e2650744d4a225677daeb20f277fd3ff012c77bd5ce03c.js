$(function(){var t=Quagga.ResultCollector.create({capture:!0,capacity:20,blacklist:[{code:"2167361334",format:"i2of5"}],filter:function(){return!0}}),e={init:function(){var a=this;Quagga.init(this.state,function(n){return n?a.handleError(n):(Quagga.registerResultCollector(t),e.attachListeners(),void Quagga.start())})},handleError:function(t){console.log(t)},attachListeners:function(){var t=this;$(".controls").on("click","button.stop",function(e){e.preventDefault(),Quagga.stop(),t._printCollectedResults()}),$(".controls .reader-config-group").on("change","input, select",function(e){e.preventDefault();var a=$(e.target),n="checkbox"===a.attr("type")?a.prop("checked"):a.val(),r=a.attr("name"),i=t._convertNameToState(r);console.log("Value of "+i+" changed to "+n),t.setState(i,n)})},_printCollectedResults:function(){var e=t.getResults(),a=$("#result_strip ul.collector");e.forEach(function(t){var e=$('<li><div class="thumbnail"><div class="imgWrapper"><img /></div><div class="caption-ingredient"><h4 class="code"></h4></div></div></li>');e.find("img").attr("src",t.frame),e.find("h4.code").html(t.codeResult.code+" ("+t.codeResult.format+")"),a.prepend(e)})},_accessByPath:function(t,e,a){var n=e.split("."),r=n.length,i="undefined"!=typeof a;return n.reduce(function(t,e,n){return i&&n+1===r&&(t[e]=a),e in t?t[e]:{}},t)},_convertNameToState:function(t){return t.replace("_",".").split("-").reduce(function(t,e){return t+e.charAt(0).toUpperCase()+e.substring(1)})},detachListeners:function(){$(".controls").off("click","button.stop"),$(".controls .reader-config-group").off("change","input, select")},setState:function(t,a){var n=this;"function"==typeof n._accessByPath(n.inputMapper,t)&&(a=n._accessByPath(n.inputMapper,t)(a)),n._accessByPath(n.state,t,a),console.log(JSON.stringify(n.state)),e.detachListeners(),Quagga.stop(),e.init()},inputMapper:{inputStream:{constraints:function(t){var e=t.split("x");return{width:{min:parseInt(e[0])},height:{min:parseInt(e[1])}}}},numOfWorkers:function(t){return parseInt(t)},decoder:{readers:function(t){return"ean_extended"===t?[{format:"ean_reader",config:{supplements:["ean_5_reader","ean_2_reader"]}}]:[{format:t+"_reader",config:{}}]}}},state:{inputStream:{type:"LiveStream",constraints:{width:{min:640},height:{min:480},facingMode:"environment",aspectRatio:{min:1,max:2}}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:4,decoder:{readers:[{format:"code_128_reader",config:{}}]},locate:!0},lastResult:null};e.init(),Quagga.onProcessed(function(t){var e=Quagga.canvas.ctx.overlay,a=Quagga.canvas.dom.overlay;t&&(t.boxes&&(e.clearRect(0,0,parseInt(a.getAttribute("width")),parseInt(a.getAttribute("height"))),t.boxes.filter(function(e){return e!==t.box}).forEach(function(t){Quagga.ImageDebug.drawPath(t,{x:0,y:1},e,{color:"green",lineWidth:2})})),t.box&&Quagga.ImageDebug.drawPath(t.box,{x:0,y:1},e,{color:"#00F",lineWidth:2}),t.codeResult&&t.codeResult.code&&Quagga.ImageDebug.drawPath(t.line,{x:"x",y:"y"},e,{color:"red",lineWidth:3}))}),Quagga.onDetected(function(t){var a=t.codeResult.code;if(e.lastResult!==a){e.lastResult=a;var n=null,r=Quagga.canvas.dom.image;n=$('<li><div class="thumbnail"><div class="imgWrapper"><img /></div><div class="caption"><h4 class="code"></h4></div></div></li>'),n.find("img").attr("src",r.toDataURL()),n.find("h4.code").html(a),$("#result_strip ul.thumbnails").prepend(n)}})});